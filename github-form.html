<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>6 CUT Campus XXII - Competition Submission Form</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }

        .form-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        input[type="text"],
        input[type="email"],
        input[type="file"],
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background: #0078d4;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-weight: 500;
        }

        button:hover {
            background: #106ebe;
        }

        button:disabled {
            background: #ccc;
        }

        #statusMessages {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .message {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }

        .success {
            background: #dff6dd;
            color: #107c10;
        }

        .error {
            background: #fde7e9;
            color: #a80000;
        }

        .progress {
            margin-top: 10px;
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: #0078d4;
            border-radius: 2px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            margin: 0;
        }

        h1 {
            font-size: 34px;
            font-weight: 500;
        }

        h3 {
            margin-top: 20px;
            color: #333;
        }

        .form-group input:invalid:not(:placeholder-shown),
        .form-group select:invalid:not(:placeholder-shown) {
            border: 1px solid #dc3545;
        }

        .form-group input:invalid:focus:not(:placeholder-shown),
        .form-group select:invalid:focus:not(:placeholder-shown) {
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }

        .checkbox-label a {
            color: #0078d4;
            text-decoration: none;
        }

        .checkbox-label a:hover {
            text-decoration: underline;
        }

        .row {
            display: flex;
            gap: 15px;
        }

        .row .form-group {
            flex: 1;
        }

        .file-upload-group {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f8f9fa;
        }

        .file-upload-group h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
        }

        .file-requirements {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="form-container">
        <h1 style="text-align: center; color:  rgb(0, 158, 227); margin-bottom: 5px;">CUT Campus XXII</h1>
        <h1 style="text-align: center; color: rgb(0, 158, 227); margin-bottom: 30px;">Competition Submission Form</h1>
        <table style="width: 100%; margin: 20px 0;">
            <tr>
                <td style="text-align: center; padding: 10px;">
                    <a href="https://pk.edu.pl/" target="_blank">
                        <img src="https://arch.pk.edu.pl/wp-content/uploads/sites/29/2025/02/80_PK_poziome.png"
                            alt="80 Years CUT Logo">
                    </a>
                </td>
                <td style="text-align: center; padding: 10px;">
                    <a href="https://arch.pk.edu.pl/" target="_blank">
                        <img src="https://arch.pk.edu.pl/wp-content/uploads/sites/29/2025/02/WA_RGB-EN_100.png"
                            alt="Faculty of Architecture Logo">
                    </a>
                </td>
            </tr>
        </table>
        <form id="uploadForm">
            <!-- Competition Settings -->
            <div class="form-group">
                <label for="participantsCount">Number of Participants:</label>
                <select id="participantsCount" name="participantsCount" required placeholder=" ">
                    <option value="1">1 Participant</option>
                    <option value="2">2 Participants</option>
                    <option value="3">3 Participants</option>
                    <option value="4">4 Participants</option>
                    <option value="5">5 Participants</option>
                </select>
            </div>
            <div class="form-group">
                <label for="competitionCategory">Competition Category:</label>
                <select id="competitionCategory" name="competitionCategory" required>
                    <option value="">Choose category</option>
                    <option value="architecture">Architecture</option>
                    <option value="urban-planning">Urban Planning</option>
                    <option value="landscape-architecture">Landscape Architecture</option>
                    <option value="heritage-conservation">Heritage and Conservation</option>
                    <option value="open">Open</option>
                </select>
            </div>

            <!-- First Participant -->
            <div id="participant1">
                <h3>Main Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName1">First Name:</label>
                        <input type="text" id="participantName1" name="participantName1" required>
                    </div>
                    <div class="form-group">
                        <label for="participantLastname1">Last Name:</label>
                        <input type="text" id="participantLastname1" name="participantLastname1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="participantEmail1">Email:</label>
                    <input type="email" id="participantEmail1" name="participantEmail1" required placeholder=" ">
                </div>
                <div class="form-group">
                    <label for="participantAddress1">Address:</label>
                    <input type="text" id="participantAddress1" name="participantAddress1" required placeholder=" ">
                </div>
                <div class="row">
                    <div class="form-group">
                        <label for="participantCity1">City:</label>
                        <input type="text" id="participantCity1" name="participantCity1" required placeholder=" ">
                    </div>
                    <div class="form-group">
                        <label for="participantCountry1">Country:</label>
                        <input type="text" id="participantCountry1" name="participantCountry1" required placeholder=" ">
                    </div>
                </div>
            </div>

            <!-- University Section -->
            <h3>University</h3>
            <div class="form-group">
                <label for="universityName">University Name:</label>
                <input type="text" id="universityName" name="universityName" required placeholder=" ">
            </div>
            <div class="form-group">
                <label for="universityFaculty">Faculty:</label>
                <input type="text" id="universityFaculty" name="universityFaculty" required placeholder=" ">
            </div>
            <div class="form-group">
                <label for="universityAddress">Address:</label>
                <input type="text" id="universityAddress" name="universityAddress" required placeholder=" ">
            </div>
            <div class="row">
                <div class="form-group">
                    <label for="universityCity">City:</label>
                    <input type="text" id="universityCity" name="universityCity" required placeholder=" ">
                </div>
                <div class="form-group">
                    <label for="universityCountry">Country:</label>
                    <input type="text" id="universityCountry" name="universityCountry" required placeholder=" ">
                </div>
            </div>

            <!-- Supervisor -->
            <div class="supervisor-info">
                <h3>Supervisor</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="supervisorName">First Name:</label>
                        <input type="text" id="supervisorName" name="supervisorName" required>
                    </div>
                    <div class="form-group">
                        <label for="supervisorLastname">Last Name:</label>
                        <input type="text" id="supervisorLastname" name="supervisorLastname" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="supervisorEmail">Email:</label>
                    <input type="email" id="supervisorEmail" name="supervisorEmail" required placeholder=" ">
                </div>
            </div>

            <!-- Additional Participants -->
            <div id="participant2" style="display: none;">
                <h3>Second Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName2">First Name:</label>
                        <input type="text" id="participantName2" name="participantName2">
                    </div>
                    <div class="form-group">
                        <label for="participantLastname2">Last Name:</label>
                        <input type="text" id="participantLastname2" name="participantLastname2">
                    </div>
                </div>
            </div>

            <div id="participant3" style="display: none;">
                <h3>Third Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName3">First Name:</label>
                        <input type="text" id="participantName3" name="participantName3">
                    </div>
                    <div class="form-group">
                        <label for="participantLastname3">Last Name:</label>
                        <input type="text" id="participantLastname3" name="participantLastname3">
                    </div>
                </div>
            </div>

            <div id="participant4" style="display: none;">
                <h3>Fourth Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName4">First Name:</label>
                        <input type="text" id="participantName4" name="participantName4">
                    </div>
                    <div class="form-group">
                        <label for="participantLastname4">Last Name:</label>
                        <input type="text" id="participantLastname4" name="participantLastname4">
                    </div>
                </div>
            </div>

            <div id="participant5" style="display: none;">
                <h3>Fifth Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName5">First Name:</label>
                        <input type="text" id="participantName5" name="participantName5">
                    </div>
                    <div class="form-group">
                        <label for="participantLastname5">Last Name:</label>
                        <input type="text" id="participantLastname5" name="participantLastname5">
                    </div>
                </div>
            </div>

            <!-- Submission Section -->
            <h3>Submission Files</h3>
            <div class="form-group">
                <label for="submissionCode">Participant 6-digit code:</label>
                <input type="text" id="submissionCode" name="submissionCode" required minlength="6" maxlength="6"
                    pattern="[0-9]{6}" placeholder="Enter 6-digit code">
            </div>

            <div class="file-upload-group">
                <h4>Required Documents (PDF)</h4>
                <div class="form-group">
                    <label for="applicationForm">Application Form:</label>
                    <input type="file" id="applicationForm" name="applicationForm" required accept=".pdf">
                    <div class="file-requirements">
                        Please upload the completed application form in PDF format
                    </div>
                <div class="file-requirements">
                    Maximum file size: 5MB
                </div>
                </div>

                <div class="form-group">
                    <label for="copyrightsAgreement">Copyrights Agreement:</label>
                    <input type="file" id="copyrightsAgreement" name="copyrightsAgreement" required accept=".pdf">
                    <div class="file-requirements">
                        Please upload the signed copyrights agreement in PDF format
                    </div>
                </div>
                <div class="file-requirements">
                    Maximum file size: 5MB
                </div>
            </div>

            <div class="file-upload-group">
                <h4>Project Boards</h4>
                <div class="form-group">
                    <label for="boardsFile">Project Boards Package:</label>
                    <input type="file" id="boardsFile" name="boardsFile" required accept=".zip">
                    <div class="file-requirements">
                        Upload a ZIP file containing:
                        <ul>
                            <li>Project boards</li>
                            <li>Project description</li>
                        </ul>
                        Maximum file size: 50MB
                    </div>
                </div>
            </div>

            <div class="file-upload-group">
                <h4>Project Images</h4>
                <div class="form-group">
                    <label for="imagesFile">Images Package:</label>
                    <input type="file" id="imagesFile" name="imagesFile" required accept=".zip">
                    <div class="file-requirements">
                        Upload a ZIP file containing:
                        <ul>
                            <li>Thumbnail image (16:9 format)</li>
                            <li>4 project images</li>
                            <li>Brief description</li>
                        </ul>
                        Maximum file size: 20MB
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="regulationsAgreement" name="regulationsAgreement" required>
                    <span>I have read the <a href="https://arch.pk.edu.pl/campus-competition" target="_blank">competition regulations</a>
                        and confirm that I have included all required files</span>
                </label>
            </div>

            <button type="submit" id="submitButton">Submit Entry</button>

            <!-- Progress Container -->
            <div class="progress-container" style="display: none; margin-top: 20px;">
                <div class="progress-info" style="margin-bottom: 5px; display: flex; justify-content: space-between;">
                    <span class="progress-text">Uploading...</span>
                    <span class="progress-percentage">0%</span>
                </div>
                <div class="progress-bar-container"
                    style="background: #f0f0f0; border-radius: 4px; height: 8px; overflow: hidden;">
                    <div class="progress-bar"
                        style="width: 0%; height: 100%; background: #0078d4; transition: width 0.3s ease-in-out;"></div>
                </div>
            </div>

            <div id="statusMessages"></div>
    </div>

    <script>
        const form = document.getElementById('uploadForm');
const participantsCount = document.getElementById('participantsCount');

// Obsługa pokazywania/ukrywania dodatkowych uczestników
participantsCount.addEventListener('change', function () {
    const count = parseInt(this.value);
    for (let i = 2; i <= 5; i++) {
        const participantDiv = document.getElementById(`participant${i}`);
        if (participantDiv) {
            participantDiv.style.display = count >= i ? 'block' : 'none';

            // Ustaw required dla pól w zależności od liczby uczestników
            const nameInput = document.getElementById(`participantName${i}`);
            const lastnameInput = document.getElementById(`participantLastname${i}`);
            if (nameInput && lastnameInput) {
                nameInput.required = count >= i;
                lastnameInput.required = count >= i;
            }
        }
    }
});

// Pomocnicze funkcje
function showMessage(text, type = 'info') {
    const status = document.getElementById('statusMessages');
    const div = document.createElement('div');
    div.className = `message ${type}`;
    div.textContent = text;
    status.insertBefore(div, status.firstChild);
}

function updateProgress(stage, percent) {
    const progressContainer = document.querySelector('.progress-container');
    progressContainer.style.display = 'block';
    const progressBar = document.querySelector('.progress-bar');
    const progressText = document.querySelector('.progress-text');
    const progressPercentage = document.querySelector('.progress-percentage');

    progressBar.style.width = percent + '%';
    progressPercentage.textContent = Math.round(percent) + '%';
    progressText.textContent = stage;
}

async function fileToBase64(file) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.readAsDataURL(file);
    });
}

// Główna funkcja obsługi formularza
form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitBtn = document.getElementById('submitButton');
    const progressContainer = document.querySelector('.progress-container');
    const status = document.getElementById('statusMessages');

    submitBtn.disabled = true;
    progressContainer.style.display = 'block';

    try {
        // Sprawdzenie akceptacji regulaminu
        if (!document.getElementById('regulationsAgreement').checked) {
            throw new Error('Musisz zaakceptować regulamin konkursu');
        }

        // Weryfikacja wszystkich plików
        const applicationForm = document.getElementById('applicationForm').files[0];
        const copyrightsAgreement = document.getElementById('copyrightsAgreement').files[0];
        const boardsFile = document.getElementById('boardsFile').files[0];
        const imagesFile = document.getElementById('imagesFile').files[0];

        if (!applicationForm || !copyrightsAgreement || !boardsFile || !imagesFile) {
            throw new Error('Wszystkie pliki są wymagane');
        }

        // Sprawdzenie rozmiaru plików
        if (applicationForm.size > 5 * 1024 * 1024 || copyrightsAgreement.size > 5 * 1024 * 1024) {
            throw new Error('Pliki PDF nie mogą przekraczać 5MB');
        }
        if (boardsFile.size > 50 * 1024 * 1024) {
            throw new Error('Plik plansz nie może przekraczać 50MB');
        }
        if (imagesFile.size > 20 * 1024 * 1024) {
            throw new Error('Plik zdjęć nie może przekraczać 20MB');
        }

        updateProgress('Przygotowywanie danych...', 30);

        // Przygotowanie kompletnego payloadu
        const completePayload = {
            // Podstawowe informacje o zgłoszeniu
            submissionCode: document.getElementById('submissionCode').value,
            participantsCount: document.getElementById('participantsCount').value,
            competitionCategory: document.getElementById('competitionCategory').value,

            // Dane uczestnika głównego
            participantName1: document.getElementById('participantName1').value,
            participantLastname1: document.getElementById('participantLastname1').value,
            participantEmail1: document.getElementById('participantEmail1').value,
            participantAddress1: document.getElementById('participantAddress1').value,
            participantCity1: document.getElementById('participantCity1').value,
            participantCountry1: document.getElementById('participantCountry1').value,

            // Dane uczelni
            universityName: document.getElementById('universityName').value,
            universityFaculty: document.getElementById('universityFaculty').value,
            universityAddress: document.getElementById('universityAddress').value,
            universityCity: document.getElementById('universityCity').value,
            universityCountry: document.getElementById('universityCountry').value,

            // Dane opiekuna
            supervisorName: document.getElementById('supervisorName').value,
            supervisorLastname: document.getElementById('supervisorLastname').value,
            supervisorEmail: document.getElementById('supervisorEmail').value,

            // Dodatkowi uczestnicy
            participantName2: document.getElementById('participantName2')?.value || '',
            participantLastname2: document.getElementById('participantLastname2')?.value || '',
            participantName3: document.getElementById('participantName3')?.value || '',
            participantLastname3: document.getElementById('participantLastname3')?.value || '',
            participantName4: document.getElementById('participantName4')?.value || '',
            participantLastname4: document.getElementById('participantLastname4')?.value || '',
            participantName5: document.getElementById('participantName5')?.value || '',
            participantLastname5: document.getElementById('participantLastname5')?.value || '',

            // Konwersja i przygotowanie plików
            fileData: {
                applicationForm: {
                    name: applicationForm.name,
                    content: await fileToBase64(applicationForm),
                    type: 'application'
                },
                copyrightsAgreement: {
                    name: copyrightsAgreement.name,
                    content: await fileToBase64(copyrightsAgreement),
                    type: 'copyrights'
                },
                boardsFile: {
                    name: boardsFile.name,
                    content: await fileToBase64(boardsFile),
                    type: 'boards'
                },
                imagesFile: {
                    name: imagesFile.name,
                    content: await fileToBase64(imagesFile),
                    type: 'images'
                }
            },

            // Znacznik czasowy
            submissionDate: new Date().toISOString(),
            
            // Status zgłoszenia
            status: 'new'
        };

        updateProgress('Wysyłanie danych...', 50);

        const response = await fetch('https://prod-64.westeurope.logic.azure.com:443/workflows/9a14d030eb3d4d288515cdc4972fcb84/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=2t8wCxQX3AmI_6fkeeymgHKvGP5o-N538GpJnOu4Jfs', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(completePayload)
        });

        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(`Błąd wysyłania danych: ${errorData.message || response.status}`);
        }

        const responseData = await response.json();

        updateProgress('Zakończono', 100);
        showMessage('Zgłoszenie zostało wysłane pomyślnie! Numer zgłoszenia: ' + completePayload.submissionCode, 'success');
        
        // Reset formularza
        form.reset();
        
        // Ukryj dodatkowych uczestników
        for (let i = 2; i <= 5; i++) {
            const participantDiv = document.getElementById(`participant${i}`);
            if (participantDiv) {
                participantDiv.style.display = 'none';
            }
        }

        // Ukryj progress bar po 3 sekundach
        setTimeout(() => {
            progressContainer.style.display = 'none';
            document.querySelector('.progress-bar').style.width = '0%';
        }, 3000);

        // Dodajemy logowanie
        console.log('Wysyłany payload:', payload);
        console.log('Rozmiar payloadu:', JSON.stringify(payload).length, 'bajtów');
        
        // Logujemy też URL
        console.log('URL:', 'https://prod-64.westeurope.logic.azure.com:443/workflows/9a14d030eb3d4d288515cdc4972fcb84/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=2t8wCxQX3AmI_6fkeeymgHKvGP5o-N538GpJnOu4Jfs');

        updateProgress('Wysyłanie metadanych...', 20);

        const response = await fetch('https://prod-64.westeurope.logic.azure.com:443/workflows/9a14d030eb3d4d288515cdc4972fcb84/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=2t8wCxQX3AmI_6fkeeymgHKvGP5o-N538GpJnOu4Jfs', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        // Logujemy odpowiedź
        console.log('Status odpowiedzi:', response.status);
        console.log('Headers odpowiedzi:', Object.fromEntries(response.headers.entries()));
        
        try {
            const responseData = await response.text();
            console.log('Treść odpowiedzi:', responseData);
        } catch (err) {
            console.log('Nie udało się odczytać treści odpowiedzi:', err);
        }

        if (!response.ok) {
            throw new Error(`Błąd wysyłania danych: ${response.status}`);
        }

    } catch (error) {
        showMessage(`Błąd: ${error.message}`, 'error');
        console.error('Błąd:', error);
        updateProgress('Wystąpił błąd', 0);
    } finally {
        submitBtn.disabled = false;
    }
});
    </script>
</body>

</html>
