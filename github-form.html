<!DOCTYPE html>
<html lang="en">
<head>
   <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>CUT Campus XXI - Competition Submission Form</title>
   <style>
       body {
           font-family: 'Segoe UI', sans-serif;
           margin: 0;
           padding: 20px;
           background: #f8f9fa;
       }
       .form-container {
           max-width: 500px;
           margin: 0 auto;
           background: white;
           padding: 20px;
           border-radius: 8px;
           box-shadow: 0 2px 4px rgba(0,0,0,0.1);
       }
       .form-group {
           margin-bottom: 15px;
       }
       label {
           display: block;
           margin-bottom: 5px;
           font-weight: 500;
           color: #333;
       }
       input[type="text"],
       input[type="email"],
       input[type="file"] {
           width: 100%;
           padding: 8px;
           border: 1px solid #ddd;
           border-radius: 4px;
           box-sizing: border-box;
       }
       button {
           background: #0078d4;
           color: white;
           padding: 10px 20px;
           border: none;
           border-radius: 4px;
           cursor: pointer;
           width: 100%;
           font-weight: 500;
       }
       button:hover {
           background: #106ebe;
       }
       button:disabled {
           background: #ccc;
       }
       #status {
           margin-top: 15px;
           padding: 10px;
           border-radius: 4px;
           font-size: 14px;
       }
       .message {
           padding: 10px;
           margin: 5px 0;
           border-radius: 4px;
       }
       .success {
           background: #dff6dd;
           color: #107c10;
       }
       .error {
           background: #fde7e9;
           color: #a80000;
       }
       .progress {
           margin-top: 10px;
           height: 4px;
           background: #f0f0f0;
           border-radius: 2px;
           display: none;
       }
       .progress-bar {
           height: 100%;
           background: #0078d4;
           border-radius: 2px;
           width: 0%;
           transition: width 0.3s ease;
       }
       select {
           width: 100%;
           padding: 8px;
           border: 1px solid #ddd;
           border-radius: 4px;
           box-sizing: border-box;
       }
       .checkbox-label {
           display: flex;
           align-items: center;
           gap: 8px;
       }
       input[type="checkbox"] {
           margin: 0;
       }
       
	   h1 {
    font-size: 24px;
    font-weight: 500;
}
	   h3 {
           margin-top: 20px;
           color: #333;
       }
      .form-group input:invalid:not(:placeholder-shown),
      .form-group select:invalid:not(:placeholder-shown) {
         border: 1px solid #dc3545;
         }

      /* Add visual feedback on focus */
      .form-group input:invalid:focus:not(:placeholder-shown),
      .form-group select:invalid:focus:not(:placeholder-shown) {
         box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
      }
            .checkbox-label a {
          color: #0078d4;
          text-decoration: none;
      }

      .checkbox-label a:hover {
          text-decoration: underline;
      }
      .row {
          display: flex;
          gap: 15px;
      }
         .row .form-group {
          flex: 1;
      }
   </style>
</head>
<body>
   <div class="form-container">
	   <div class="form-container">
   <h1 style="text-align: center; color: #333; margin-bottom: 30px;">CUT Campus XXI - Competition Submission Form</h1>
   <form id="uploadForm">
       <form id="uploadForm">
           <div class="form-group">
               <label for="participantsCount">Number of Participants:</label>
               <select id="participantsCount" name="participantsCount" required placeholder=" ">
                   <option value="1">1 Participant</option>
                   <option value="2">2 Participants</option>
                   <option value="3">3 Participants</option>
               </select>
           </div>

           <div id="participant1">
               <h3>Main Participant</h3>
               <div class="row">
    <div class="form-group">
        <label for="name1">First Name:</label>
        <input type="text" id="name1" name="name1" required>
    </div>
    <div class="form-group">
        <label for="lastname1">Last Name:</label>
        <input type="text" id="lastname1" name="lastname1" required>
    </div>
</div>
               <div class="form-group">
                   <label for="email1">Email:</label>
                   <input type="email" id="email1" name="email1" required placeholder=" ">
               </div>
               <div class="form-group">
                   <label for="address1">Address:</label>
                   <input type="text" id="address1" name="address1" required placeholder=" ">
               </div>
               <div class="form-group">
                   <label for="universityName1">University Name:</label>
                   <input type="text" id="universityName1" name="universityName1" required placeholder=" ">
               </div>
               <div class="form-group">
                   <label for="faculty1">Faculty:</label>
                   <input type="text" id="faculty1" name="faculty1" required placeholder=" ">
               </div>
           </div>

           <div class="supervisor-info">
               <h3>Supervisor</h3>
<div class="row">
    <div class="form-group">
        <label for="supervisorName">First Name:</label>
        <input type="text" id="supervisorName" name="supervisorName" required>
    </div>
    <div class="form-group">
        <label for="supervisorLastname">Last Name:</label>
        <input type="text" id="supervisorLastname" name="supervisorLastname" required>
    </div>
</div>
               <div class="form-group">
                   <label for="supervisorEmail">Email:</label>
                   <input type="email" id="supervisorEmail" name="supervisorEmail" required placeholder=" ">
               </div>
           </div>

           <div id="participant2" style="display: none;">
               <h3>Second Participant</h3>
<div class="row">
    <div class="form-group">
        <label for="name2">First Name:</label>
        <input type="text" id="name2" name="name2">
    </div>
    <div class="form-group">
        <label for="lastname2">Last Name:</label>
        <input type="text" id="lastname2" name="lastname2">
    </div>
</div>
           </div>

           <div id="participant3" style="display: none;">
               <h3>Third Participant</h3>
<div class="row">
    <div class="form-group">
        <label for="name3">First Name:</label>
        <input type="text" id="name3" name="name3">
    </div>
    <div class="form-group">
        <label for="lastname3">Last Name:</label>
        <input type="text" id="lastname3" name="lastname3">
    </div>
</div>
           </div>
				<h3>Submission file</h3>
           <div class="form-group">
               <label for="title">Participant 6-digit code:</label>
               <input type="text" id="title" name="title" required 
                   minlength="6" maxlength="6" pattern="[0-9]{6}"
                   placeholder="Enter 6-digit code">
            </div>
           
           <div class="form-group">
               <label for="fileInput">Submission file:</label>
               <input type="file" id="fileInput" name="file" required 
                      accept=".zip">
               <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    File name must be 6 digits (same as code) with .zip extension (max 50MB)
               </div>
           </div>

           <div class="form-group">
               <label class="checkbox-label">
                   <input type="checkbox" id="agreeRegulations" name="agreeRegulations" required>
                   I agree with <a href="https://arch.pk.edu.pl/" target="_blank">the regulations</a>
               </label>
           </div>
           
           <button type="submit" id="submitBtn">Submit Entry</button>
       </form>

       <div class="progress" id="progress">
           <div class="progress-bar" id="progressBar"></div>
       </div>

       <div id="status"></div>
   </div>

   <script>
       const form = document.getElementById('uploadForm');
       const submitBtn = document.getElementById('submitBtn');
       const progress = document.getElementById('progress');
       const progressBar = document.getElementById('progressBar');
       const status = document.getElementById('status');

       document.getElementById('participantsCount').addEventListener('change', function() {
           const count = parseInt(this.value);
           document.getElementById('participant2').style.display = count >= 2 ? 'block' : 'none';
           document.getElementById('participant3').style.display = count >= 3 ? 'block' : 'none';
           
           const p2Inputs = document.getElementById('participant2').querySelectorAll('input');
           const p3Inputs = document.getElementById('participant3').querySelectorAll('input');
           
           p2Inputs.forEach(input => input.required = count >= 2);
           p3Inputs.forEach(input => input.required = count >= 3);
       });

       function showMessage(text, type = 'info') {
           const div = document.createElement('div');
           div.className = `message ${type}`;
           div.textContent = text;
           status.insertBefore(div, status.firstChild);
       }

       function updateProgress(percent) {
           progress.style.display = 'block';
           progressBar.style.width = `${percent}%`;
       }

       form.addEventListener('submit', async (e) => {
        e.preventDefault();
    
        const file = document.getElementById('fileInput').files[0];
        const title = document.getElementById('title').value.trim();
    
         if (!file || !title) {
            showMessage('Fill in all fields', 'error');
            return;
          }

          if (!/^\d{6}$/.test(title)) {
              showMessage('Code must be exactly 6 digits', 'error');
              return;
          }

          if (file.size > 50 * 1024 * 1024) {
              showMessage('File is too large (max 50MB)', 'error');
              return;
          }

           if (!document.getElementById('agreeRegulations').checked) {
               showMessage('You must agree to the regulations', 'error');
               return;
           }
		// Add to form validation
	const fileCode = file.name.split('.')[0];  // Get filename without extension
	if (title !== fileCode) {
	   showMessage('6-digit code must match the filename', 'error');
 	  return;
	}

	if (!/^\d{6}\.zip$/.test(file.name)) {
 	  showMessage('Filename must be 6 digits with .zip extension', 'error');
  	 return;
	}

           submitBtn.disabled = true;
           progress.style.display = 'block';
           updateProgress(0);
           showMessage('Starting upload...');

           try {
               const reader = new FileReader();
               
               reader.onload = async () => {
                   try {
                       updateProgress(30);
                       const base64 = reader.result.split(',')[1];
                       updateProgress(50);
                       
                       const payload = {
                           title: title,
                           email: document.getElementById('email1').value,
                           fileName: file.name,
                           fileContent: base64,
                           name1: document.getElementById('name1').value,
                           lastname1: document.getElementById('lastname1').value,
                           email1: document.getElementById('email1').value,
                           address1: document.getElementById('address1').value,
                           universityName1: document.getElementById('universityName1').value,
                           faculty1: document.getElementById('faculty1').value,
                           supervisorName: document.getElementById('supervisorName').value,
                           supervisorLastname: document.getElementById('supervisorLastname').value,
                           supervisorEmail: document.getElementById('supervisorEmail').value,
                           name2: document.getElementById('name2').value,
                           lastname2: document.getElementById('lastname2').value,
                           name3: document.getElementById('name3').value,
                           lastname3: document.getElementById('lastname3').value,
                           agreeRegulations: document.getElementById('agreeRegulations').checked
                       };
                       
                       showMessage('Sending to database...');
                       updateProgress(70);
                       
                       const response = await fetch('https://prod-105.westeurope.logic.azure.com:443/workflows/984107669de44dc3bbddba0af93eb18b/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=TFwMLojCw61tQssgYnNecwud7uqkAZ-4OVHdloox6z0', {
                           method: 'POST',
                           headers: {
                               'Content-Type': 'application/json'
                           },
                           body: JSON.stringify(payload)
                       });
                       
                       updateProgress(90);
                       
                       if (response.ok) {
                           updateProgress(100);
                           showMessage('Submission successful! Check your email for confirmation.', 'success');
                           form.reset();
                           setTimeout(() => {
                               progress.style.display = 'none';
                               progressBar.style.width = '0%';
                           }, 1000);
                       } else {
                           throw new Error(`Server error: ${response.status}`);
                       }
                   } catch (error) {
                       showMessage(`Error: ${error.message}`, 'error');
                       console.error('Error:', error);
                   } finally {
                       submitBtn.disabled = false;
                   }
               };
               
               reader.onerror = () => {
                   showMessage('File reading error', 'error');
                   submitBtn.disabled = false;
               };
               
               reader.readAsDataURL(file);
               
           } catch (error) {
               showMessage(`Error: ${error.message}`, 'error');
               console.error('Error:', error);
               submitBtn.disabled = false;
           }
       });
   </script>
</body>
</html>
