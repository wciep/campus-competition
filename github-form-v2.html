<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>CUT Campus XXII - Competition Submission Form</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }

        .form-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        input[type="text"],
        input[type="email"],
        input[type="file"],
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background: #0078d4;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-weight: 500;
        }

        button:hover {
            background: #106ebe;
        }

        button:disabled {
            background: #ccc;
        }

        #statusMessages {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .message {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }

        .success {
            background: #dff6dd;
            color: #107c10;
        }

        .error {
            background: #fde7e9;
            color: #a80000;
        }

        .progress {
            margin-top: 10px;
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: #0078d4;
            border-radius: 2px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            margin: 0;
        }

        h1 {
            font-size: 34px;
            font-weight: 500;
        }

        h3 {
            margin-top: 20px;
            color: #333;
        }

        .form-group input:invalid:not(:placeholder-shown),
        .form-group select:invalid:not(:placeholder-shown) {
            border: 1px solid #dc3545;
        }

        .form-group input:invalid:focus:not(:placeholder-shown),
        .form-group select:invalid:focus:not(:placeholder-shown) {
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }

        .checkbox-label a {
            color: #0078d4;
            text-decoration: none;
        }

        .checkbox-label a:hover {
            text-decoration: underline;
        }

        .row {
            display: flex;
            gap: 15px;
        }

        .row .form-group {
            flex: 1;
        }

        .file-upload-group {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f8f9fa;
        }

        .file-upload-group h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
        }

        .file-requirements {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="form-container">
        <h1 style="text-align: center; color:  rgb(0, 158, 227); margin-bottom: 5px;">CUT Campus XXII</h1>
        <h1 style="text-align: center; color: rgb(0, 158, 227); margin-bottom: 30px;">Competition Submission Form</h1>
        <table style="width: 100%; margin: 20px 0;">
            <tr>
                <td style="text-align: center; padding: 10px;">
                    <a href="https://pk.edu.pl/" target="_blank">
                        <img src="https://arch.pk.edu.pl/wp-content/uploads/sites/29/2025/02/80_PK_poziome.png"
                            alt="80 Years CUT Logo">
                    </a>
                </td>
                <td style="text-align: center; padding: 10px;">
                    <a href="https://arch.pk.edu.pl/" target="_blank">
                        <img src="https://arch.pk.edu.pl/wp-content/uploads/sites/29/2025/02/WA_RGB-EN_100.png"
                            alt="Faculty of Architecture Logo">
                    </a>
                </td>
            </tr>
        </table>
        <form id="uploadForm">
            <!-- Competition Settings -->
            <div class="form-group">
                <label for="participantsCount">Number of Participants:</label>
                <select id="participantsCount" name="participantsCount" required placeholder=" ">
                    <option value="1">1 Participant</option>
                    <option value="2">2 Participants</option>
                    <option value="3">3 Participants</option>
                    <option value="4">4 Participants</option>
                    <option value="5">5 Participants</option>
                </select>
            </div>
            <div class="form-group">
                <label for="competitionCategory">Competition Category:</label>
                <select id="competitionCategory" name="competitionCategory" required>
                    <option value="">Choose category</option>
                    <option value="architecture">Architecture</option>
                    <option value="urban-planning">Urban Planning</option>
                    <option value="landscape-architecture">Landscape Architecture</option>
                    <option value="heritage-conservation">Heritage and Conservation</option>
                    <option value="open">Open</option>
                </select>
            </div>

            <!-- First Participant -->
            <div id="participant1">
                <h3>Main Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName1">First Name:</label>
                        <input type="text" id="participantName1" name="participantName1" required>
                    </div>
                    <div class="form-group">
                        <label for="participantLastname1">Last Name:</label>
                        <input type="text" id="participantLastname1" name="participantLastname1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="participantEmail1">Email:</label>
                    <input type="email" id="participantEmail1" name="participantEmail1" required placeholder=" ">
                </div>
                <div class="form-group">
                    <label for="participantAddress1">Address:</label>
                    <input type="text" id="participantAddress1" name="participantAddress1" required placeholder=" ">
                </div>
                <div class="row">
                    <div class="form-group">
                        <label for="participantCity1">City:</label>
                        <input type="text" id="participantCity1" name="participantCity1" required placeholder=" ">
                    </div>
                    <div class="form-group">
                        <label for="participantCountry1">Country:</label>
                        <input type="text" id="participantCountry1" name="participantCountry1" required placeholder=" ">
                    </div>
                </div>
            </div>

            <!-- University Section -->
            <h3>University</h3>
            <div class="form-group">
                <label for="universityName">University Name:</label>
                <input type="text" id="universityName" name="universityName" required placeholder=" ">
            </div>
            <div class="form-group">
                <label for="universityFaculty">Faculty:</label>
                <input type="text" id="universityFaculty" name="universityFaculty" required placeholder=" ">
            </div>
            <div class="form-group">
                <label for="universityAddress">Address:</label>
                <input type="text" id="universityAddress" name="universityAddress" required placeholder=" ">
            </div>
            <div class="row">
                <div class="form-group">
                    <label for="universityCity">City:</label>
                    <input type="text" id="universityCity" name="universityCity" required placeholder=" ">
                </div>
                <div class="form-group">
                    <label for="universityCountry">Country:</label>
                    <input type="text" id="universityCountry" name="universityCountry" required placeholder=" ">
                </div>
            </div>

            <!-- Supervisor -->
            <div class="supervisor-info">
                <h3>Supervisor</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="supervisorName">First Name:</label>
                        <input type="text" id="supervisorName" name="supervisorName" required>
                    </div>
                    <div class="form-group">
                        <label for="supervisorLastname">Last Name:</label>
                        <input type="text" id="supervisorLastname" name="supervisorLastname" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="supervisorEmail">Email:</label>
                    <input type="email" id="supervisorEmail" name="supervisorEmail" required placeholder=" ">
                </div>
            </div>

            <!-- Additional Participants -->
            <div id="participant2" style="display: none;">
                <h3>Second Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName2">First Name:</label>
                        <input type="text" id="participantName2" name="participantName2">
                    </div>
                    <div class="form-group">
                        <label for="participantLastname2">Last Name:</label>
                        <input type="text" id="participantLastname2" name="participantLastname2">
                    </div>
                </div>
            </div>

            <div id="participant3" style="display: none;">
                <h3>Third Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName3">First Name:</label>
                        <input type="text" id="participantName3" name="participantName3">
                    </div>
                    <div class="form-group">
                        <label for="participantLastname3">Last Name:</label>
                        <input type="text" id="participantLastname3" name="participantLastname3">
                    </div>
                </div>
            </div>

            <div id="participant4" style="display: none;">
                <h3>Fourth Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName4">First Name:</label>
                        <input type="text" id="participantName4" name="participantName4">
                    </div>
                    <div class="form-group">
                        <label for="participantLastname4">Last Name:</label>
                        <input type="text" id="participantLastname4" name="participantLastname4">
                    </div>
                </div>
            </div>

            <div id="participant5" style="display: none;">
                <h3>Fifth Participant</h3>
                <div class="row">
                    <div class="form-group">
                        <label for="participantName5">First Name:</label>
                        <input type="text" id="participantName5" name="participantName5">
                    </div>
                    <div class="form-group">
                        <label for="participantLastname5">Last Name:</label>
                        <input type="text" id="participantLastname5" name="participantLastname5">
                    </div>
                </div>
            </div>

            <!-- Submission Section -->
            <h3>Submission Files</h3>
            <div class="form-group">
                <label for="submissionCode">Participant 6-digit code:</label>
                <input type="text" id="submissionCode" name="submissionCode" required minlength="6" maxlength="6"
                    pattern="[0-9]{6}" placeholder="Enter 6-digit code">
            </div>

            <div class="file-upload-group">
                <h4>Required Documents (PDF)</h4>
                <div class="form-group">
                    <label for="applicationForm">Application Form:</label>
                    <input type="file" id="applicationForm" name="applicationForm" required accept=".pdf">
                    <div class="file-requirements">
                        Please upload the completed application form in PDF format
                    </div>
                </div>

                <div class="form-group">
                    <label for="copyrightsAgreement">Copyrights Agreement:</label>
                    <input type="file" id="copyrightsAgreement" name="copyrightsAgreement" required accept=".pdf">
                    <div class="file-requirements">
                        Please upload the signed copyrights agreement in PDF format
                    </div>
                </div>
                <div class="file-requirements">
                    Maximum file size: 10MB
                </div>
            </div>

            <div class="file-upload-group">
                <h4>Project Boards</h4>
                <div class="form-group">
                    <label for="boardsFile">Project Boards Package:</label>
                    <input type="file" id="boardsFile" name="boardsFile" required accept=".zip">
                    <div class="file-requirements">
                        Upload a ZIP file containing:
                        <ul>
                            <li>Project boards</li>
                            <li>Project description</li>
                        </ul>
                        Maximum file size: 50MB
                    </div>
                </div>
            </div>

            <div class="file-upload-group">
                <h4>Project Images</h4>
                <div class="form-group">
                    <label for="imagesFile">Images Package:</label>
                    <input type="file" id="imagesFile" name="imagesFile" required accept=".zip">
                    <div class="file-requirements">
                        Upload a ZIP file containing:
                        <ul>
                            <li>Thumbnail image (16:9 format)</li>
                            <li>4 project images</li>
                            <li>Brief description</li>
                        </ul>
                        Maximum file size: 20MB
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="regulationsAgreement" name="regulationsAgreement" required>
                    <span>I have read the <a href="https://arch.pk.edu.pl/" target="_blank">competition regulations</a>
                        and confirm that I have included all required files</span>
                </label>
            </div>

            <button type="submit" id="submitButton">Submit Entry</button>

            <!-- Progress Container -->
            <div class="progress-container" style="display: none; margin-top: 20px;">
                <div class="progress-info" style="margin-bottom: 5px; display: flex; justify-content: space-between;">
                    <span class="progress-text">Uploading...</span>
                    <span class="progress-percentage">0%</span>
                </div>
                <div class="progress-bar-container"
                    style="background: #f0f0f0; border-radius: 4px; height: 8px; overflow: hidden;">
                    <div class="progress-bar"
                        style="width: 0%; height: 100%; background: #0078d4; transition: width 0.3s ease-in-out;"></div>
                </div>
            </div>

            <div id="statusMessages"></div>
    </div>

    <script>
        const form = document.getElementById('uploadForm');
        const submitBtn = document.getElementById('submitButton');
        const progressContainer = document.querySelector('.progress-container');
        const progressBar = document.querySelector('.progress-bar');
        const progressText = document.querySelector('.progress-text');
        const progressPercentage = document.querySelector('.progress-percentage');
        const status = document.getElementById('statusMessages');

        document.getElementById('participantsCount').addEventListener('change', function () {
            const count = parseInt(this.value);

            // Pokazywanie/ukrywanie sekcji uczestników
            for (let i = 2; i <= 5; i++) {
                const participantDiv = document.getElementById(`participant${i}`);
                if (participantDiv) {
                    participantDiv.style.display = count >= i ? 'block' : 'none';
                }
            }

            // Ustawianie required dla pól uczestników
            for (let i = 2; i <= 5; i++) {
                const nameInput = document.getElementById(`participantName${i}`);
                const lastnameInput = document.getElementById(`participantLastname${i}`);

                if (nameInput && lastnameInput) {
                    nameInput.required = count >= i;
                    lastnameInput.required = count >= i;
                }
            }
        });

        function showMessage(text, type = 'info') {
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.textContent = text;
            status.insertBefore(div, status.firstChild);
        }

        function updateProgress(stage, percent) {
            progressContainer.style.display = 'block';
            progressBar.style.width = percent + '%';
            progressPercentage.textContent = Math.round(percent) + '%';

            switch (stage) {
                case 'reading':
                    progressText.textContent = 'Reading file...';
                    break;
                case 'encoding':
                    progressText.textContent = 'Processing file...';
                    break;
                case 'uploading':
                    progressText.textContent = 'Uploading file...';
                    break;
                case 'saving':
                    progressText.textContent = 'Saving file...';
                    break;
                case 'complete':
                    progressText.textContent = 'Upload complete!';
                    break;
            }
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const files = {
                applicationForm: document.getElementById('applicationForm').files[0],
                copyrightsAgreement: document.getElementById('copyrightsAgreement').files[0],
                boardsFile: document.getElementById('boardsFile').files[0],
                imagesFile: document.getElementById('imagesFile').files[0]
            };

            const title = document.getElementById('submissionCode').value.trim();

            // Basic validation
            if (!files.applicationForm || !files.copyrightsAgreement ||
                !files.boardsFile || !files.imagesFile || !title) {
                showMessage('Please upload all required files', 'error');
                return;
            }


            // Check file extensions
            const isPDF = (filename) => filename.toLowerCase().endsWith('.pdf');
            const isZIP = (filename) => filename.toLowerCase().endsWith('.zip');

            if (!isPDF(files.applicationForm.name)) {
                showMessage('Application Form must be a PDF file', 'error');
                return;
            }

            if (!isPDF(files.copyrightsAgreement.name)) {
                showMessage('Copyrights Agreement must be a PDF file', 'error');
                return;
            }

            if (!isZIP(files.boardsFile.name)) {
                showMessage('Project Boards Package must be a ZIP file', 'error');
                return;
            }

            if (!isZIP(files.imagesFile.name)) {
                showMessage('Images Package must be a ZIP file', 'error');
                return;
            }

            if (!/^\d{6}$/.test(title)) {
                showMessage('Code must be exactly 6 digits', 'error');
                return;
            }

            // Check individual file sizes
            const pdfSize = files.applicationForm.size + files.copyrightsAgreement.size;
            if (pdfSize > 10 * 1024 * 1024) {
                showMessage('PDF documents exceed maximum size (10MB)', 'error');
                return;
            }

            if (files.boardsFile.size > 50 * 1024 * 1024) {
                showMessage('Project boards file exceeds maximum size (50MB)', 'error');
                return;
            }

            if (files.imagesFile.size > 20 * 1024 * 1024) {
                showMessage('Images package exceeds maximum size (20MB)', 'error');
                return;
            }

            if (!document.getElementById('regulationsAgreement').checked) {
                showMessage('You must agree to the regulations', 'error');
                return;
            }

            submitBtn.disabled = true;
            progressContainer.style.display = 'block';
            updateProgress('reading', 0);

            try {
                const fileReaders = {};
                const fileContents = {};

                // Function to read a single file
                const readFile = (file, fileKey) => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        fileReaders[fileKey] = reader;

                        reader.onprogress = (event) => {
                            if (event.lengthComputable) {
                                const percent = (event.loaded / event.total) * 25;
                                updateProgress('reading', percent);
                            }
                        };

                        reader.onload = () => {
                            const base64Data = reader.result.split(',')[1];
                            fileContents[fileKey] = base64Data.replace(/=/g, '').padEnd(base64Data.length + (4 - base64Data.length % 4) % 4, '=');
                            resolve();
                        };

                        reader.onerror = () => {
                            reject(new Error(`Error reading ${fileKey}`));
                        };

                        reader.readAsDataURL(file);
                    });
                };

                // Read all files
                await Promise.all(Object.entries(files).map(([key, file]) => readFile(file, key)));

                updateProgress('encoding', 30);

                // Log file sizes for debugging
                Object.entries(files).forEach(([key, file]) => {
                    console.log(`${key} original size:`, file.size);
                    console.log(`${key} encoded size:`, fileContents[key].length);
                });

                updateProgress('encoding', 50);

                // Prepare payload with all form data and files
                const payload = {
                    submissionCode: title,

                    // File contents
                    applicationFormContent: fileContents.applicationForm,
                    applicationFormName: files.applicationForm.name,
                    copyrightsAgreementContent: fileContents.copyrightsAgreement,
                    copyrightsAgreementName: files.copyrightsAgreement.name,
                    boardsFileContent: fileContents.boardsFile,
                    boardsFileName: files.boardsFile.name,
                    imagesFileContent: fileContents.imagesFile,
                    imagesFileName: files.imagesFile.name,

                    // Competition details
                    competitionCategory: document.getElementById('competitionCategory').value,

                    // Form data
                    participantName1: document.getElementById('participantName1').value,
                    participantLastname1: document.getElementById('participantLastname1').value,
                    participantEmail1: document.getElementById('participantEmail1').value,
                    participantAddress1: document.getElementById('participantAddress1').value,
                    participantCity1: document.getElementById('participantCity1').value,
                    participantCountry1: document.getElementById('participantCountry1').value,

                    // University details
                    universityName: document.getElementById('universityName').value,
                    universityFaculty: document.getElementById('universityFaculty').value,
                    universityAddress: document.getElementById('universityAddress').value,
                    universityCity: document.getElementById('universityCity').value,
                    universityCountry: document.getElementById('universityCountry').value,

                    // Supervisor details
                    supervisorName: document.getElementById('supervisorName').value,
                    supervisorLastname: document.getElementById('supervisorLastname').value,
                    supervisorEmail: document.getElementById('supervisorEmail').value,

                    // Additional participants
                    participantName2: document.getElementById('participantName2')?.value || '',
                    participantLastname2: document.getElementById('participantLastname2')?.value || '',
                    participantName3: document.getElementById('participantName3')?.value || '',
                    participantLastname3: document.getElementById('participantLastname3')?.value || '',
                    participantName4: document.getElementById('participantName4')?.value || '',
                    participantLastname4: document.getElementById('participantLastname4')?.value || '',
                    participantName5: document.getElementById('participantName5')?.value || '',
                    participantLastname5: document.getElementById('participantLastname5')?.value || '',

                    regulationsAgreement: document.getElementById('regulationsAgreement').checked
                };

                showMessage('Sending files to server...');
                updateProgress('uploading', 70);

                const response = await fetch('https://prod-105.westeurope.logic.azure.com:443/workflows/984107669de44dc3bbddba0af93eb18b/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=TFwMLojCw61tQssgYnNecwud7uqkAZ-4OVHdloox6z0', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                updateProgress('saving', 90);

                if (response.ok) {
                    const responseData = await response.text();
                    console.log('Upload response:', responseData);
                    updateProgress('complete', 100);
                    showMessage('Submission successful! Check your email for confirmation.', 'success');
                    form.reset();
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        progressBar.style.width = '0%';
                    }, 3000);
                } else {
                    throw new Error(`Server error: ${response.status} - ${await response.text()}`);
                }
            } catch (error) {
                showMessage(`Error: ${error.message}`, 'error');
                console.error('Error:', error);
                progressContainer.style.display = 'none';
            } finally {
                submitBtn.disabled = false;
            }
        });
    </script>
</body>

</html>
